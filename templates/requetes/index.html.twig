{% extends 'authenticated.html.twig' %}

{% block title %}
{{ 'requetes.title'|trans }}
{% endblock %}

{% block head %}
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12 table-buttons">
        <button type="button" class="btn btn-warning clear-filter-button" onclick="clearFilters()"><!-- Ajouter la fonction onclick -->
            {{ 'generic.clear_filters'|trans }}
        </button>
        <button type="button" class="btn btn-primary" onclick="ajouterFiltre()">Ajouter</button><br /> <br />
    </div>
</div>

<div id="liste_critere">
       {{ formulaire | raw }}
</div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        //Ajouter le bouton export CSV/PDF

        function clearFilters(){
            //Todo
        }

        $( document ).ready(function(){//Le document ready
            //Peut-être mettre directement le text dans les <option> au moins j'aurai la traduction
        });
            
        var $formulaire_critere= $('#liste_critere').html();//Variable qui prend le formulaire
        function ajouterFiltre(){
            $("#liste_critere").append($formulaire_critere);
            return;
        }

        function removeFiltre(currentElement){//Par rapport au bouton supprimer
            $(currentElement).parent().next().remove();//Le br
            $(currentElement).parent().remove();//La div
            return;
        }

        function secondeBox(currentElement){//Pour le onchange de la première box
            var valeurSelect = $(currentElement).children("option:selected").val()
            var box2 =  $(currentElement).parent().next().children();
            $(box2).empty();//Il faut vider le HTML de la seconde box sinon ça ajoute
            remplirSecondeBox(valeurSelect, box2);
            return;
        }

        function remplirSecondeBox(valeur, box){//Afficher les <option> par rapport à la première box, sur la seconde box
            $.each(tabObjets, function(i, obj){//On parcourt le tableau JSON
                if(i==valeur){//On vérifie que ça corresponde bien à ce qu'il y a dans la box 1
                    for(var i =0 ; i<obj.length; i++){//Boucle for pour afficher tous les objets
                        $(box).append("<option value=\""+obj[i].nomBDD+"\">"+obj[i].nom+" </option>");
                    }
                }
            })
            box.css("visibility","visible"); //On affiche le second select
            return;
        }


    //Le .change sur les deux autres en AJAX avec appel des fonctions et affichage de la suite des requêtes

    //Type : Booléen(0), String/Text(1), Liste(2), Number(3),Lien existe(4) -> Si le lien existe entre telle et telle table, en soi juste une jointure
    //Catégories : Les grandes catégories (Première box)

     var tabObjets = {
         "attestation": [
              { "nom" : "{{ 'attestation.fields.prose' |trans }}" ,
                "type" : 0,
                "nomBDD" : "prose",
                "table" : "attestation" },

            { "nom" : "{{ 'attestation.fields.poesie' |trans }}" ,
                "type" : 0,
                "nomBDD" : "poesie",
                "table" : "attestation" },

           { "nom" : "{{ 'attestation.fields.translitteration' |trans }}" ,
                "type" : 1,
                "nomBDD" : "translitteration",
                "table" : "attestation" },
           
           { "nom" : "{{ 'generic.fields.commentaire_fr' |trans }}" ,
                "type" : 1,
                "nomBDD" : "commentaire_fr",
                "table" : "attestation" },
                           
           { "nom" : "{{ 'generic.fields.commentaire_en' |trans }}" ,
                "type" : 1,
                "nomBDD" : "commentaire_en",
                "table" : "attestation" },
             
           { "nom" : "{{ 'attestation.fields.etat_fiche' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "etat_fiche" },
                             
           { "nom" : "{{ 'attestation.fields.categorie_occasion' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "categorie_occasion" },
                                             
           { "nom" : "{{ 'attestation.fields.occasion' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "occasion" },
                                             
           { "nom" : "{{ 'attestation.fields.categorie_materiel' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "categorie_materiel" },
                                                             
           { "nom" : "{{ 'attestation.fields.materiel' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "materiel" }                
            ],

        "agent": [
              { "nom" : "{{ 'agent.fields.designation' |trans }}" ,
                "type" : 1,
                "nomBDD" : "designation",
                "table" : "agent" },

            { "nom" : "{{ 'generic.fields.commentaire_fr' |trans }}" ,
                "type" : 1,
                "nomBDD" : "commentaire_fr",
                "table" : "agent" },

           { "nom" : "{{ 'generic.fields.commentaire_en' |trans }}" ,
                "type" : 1,
                "nomBDD" : "commentaire_en",
                "table" : "agent" },
                
           { "nom" : "{{ 'agent.fields.agentivite' |trans }}" ,
                "type" : 1,
                "nomBDD" : "nom_fr",
                "table" : "agentivite" },
                                
           { "nom" : "{{ 'agent.fields.nature' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "nature" },
                                                
           { "nom" : "{{ 'agent.fields.genre' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "genre" },        
                                                                
           { "nom" : "{{ 'agent.fields.statut_affiche' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "statut_affiche" }, 
                                                                                
           { "nom" : "{{ 'agent.fields.activite' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "activite_agent" }            
           ],

        "localisation": [                                                          
           { "nom" : "{{ 'generic.fields.localisation_reelle' |trans }}" ,
                "type" : 0,
                "nomBDD" : "reel",
                "table" : "localisation" }, 
            
            { "nom" : "{{ 'localisation.fields.nom_ville' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_ville",
                "table" : "localisation" }, 
                            
            { "nom" : "{{ 'localisation.fields.nom_site' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_site",
                "table" : "localisation" }, 

            { "nom" : "{{ 'generic.fields.commentaire_fr' |trans }}" ,
                "type" : 1,
                "nomBDD" : "commentaire_fr",
                "table" : "localisation" },

           { "nom" : "{{ 'generic.fields.commentaire_en' |trans }}" ,
                "type" : 1,
                "nomBDD" : "commentaire_en",
                "table" : "localisation" },
                
           { "nom" : "{{ 'localisation.fields.entite_politique' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "entite_politique" },
                                
           { "nom" : "{{ 'localisation.fields.grande_region' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "grande_region" },
                                
           { "nom" : "{{ 'localisation.fields.sous_region' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "sous_region" },
                                
           { "nom" : "{{ 'localisation.fields.topographie' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "q_topographie" },
                                
           { "nom" : "{{ 'localisation.fields.fonction' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "q_fonction" },
             ],

        "element":[
           { "nom" : "{{ 'eleme,t.fields.etat_absolu' |trans }}" ,
                "type" : 1,
                "nomBDD" : "etat_absolu",
                "table" : "element" },

            { "nom" : "{{ 'generic.fields.commentaire_fr' |trans }}" ,
                "type" : 1,
                "nomBDD" : "commentaire_fr",
                "table" : "element" },

           { "nom" : "{{ 'generic.fields.commentaire_en' |trans }}" ,
                "type" : 1,
                "nomBDD" : "commentaire_en",
                "table" : "element" },
                
           { "nom" : "{{ 'element.fields.etat_morphologique' |trans }}" ,
                "type" : 2,
                "nomBDD" : "commentaire_en",
                "table" : "contient_element" },
                                
           { "nom" : "{{ 'element.fields.beta_code' |trans }}" ,
                "type" : 1,
                "nomBDD" : "beta_code",
                "table" : "element" },
                                
           { "nom" : "{{ 'element.fields.suffixe' |trans }}" ,
                "type" : 0,
                "nomBDD" : "suffixe",
                "table" : "contient_element" },
                                                
           { "nom" : "{{ 'element.fields.genre' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "genre_element" },
                                                
           { "nom" : "{{ 'element.fields.nombre' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "nombre_element" },
                                  
           { "nom" : "{{ 'element.fields.nombre' |trans }}" ,
                "type" : 2,
                "nomBDD" : "nom_fr",
                "table" : "nombre_element" },
            ]   
        }
    </script>
{% endblock %}